{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Experiment Runs</h1>
    <a href="{{ url_for('web.run_new') }}" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4v16m-8-8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        New Run
    </a>
</div>

{% if runs %}
<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Profile</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for run in runs %}
            <tr>
                <td>
                    <a href="{{ url_for('web.run_view', run_id=run.run_id) }}">
                        {{ run.name or run.run_id }}
                    </a>
                </td>
                <td>
                    <span class="text-secondary">{{ run.profile_name }}</span>
                </td>
                <td>
                    {% if run.status == 'completed' %}
                        <span class="badge badge-success">✓ Completed</span>
                    {% elif run.status == 'running' %}
                        <span class="badge badge-info">● Running</span>
                    {% elif run.status == 'paused' %}
                        <span class="badge badge-warning">⏸ Paused</span>
                    {% elif run.status == 'interrupted' %}
                        <span class="badge badge-danger">⚠ Interrupted</span>
                    {% elif run.status == 'failed' %}
                        <span class="badge badge-danger">✗ Failed</span>
                    {% else %}
                        <span class="badge">{{ run.status }}</span>
                    {% endif %}
                </td>
                <td>
                    <span class="text-secondary">{{ run.created_at[:19].replace('T', ' ') }}</span>
                </td>
                <td>
                    <div class="flex gap-8">
                        <a href="{{ url_for('web.run_view', run_id=run.run_id) }}" class="btn btn-sm">View</a>
                        <a href="{{ url_for('web.run_export', run_id=run.run_id) }}" class="btn btn-sm">Export</a>
                        <button class="btn btn-sm btn-danger" onclick="deleteRun('{{ run.run_id }}')">Delete</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
            <path d="M7 12h2v5H7zm4-3h2v8h-2zm4-3h2v11h-2z"/>
        </svg>
        <h3>No experiments yet</h3>
        <p class="text-muted">Create your first experiment run to get started.</p>
        <a href="{{ url_for('web.run_new') }}" class="btn btn-primary mt-16">Create Run</a>
    </div>
</div>
{% endif %}

<script>
async function deleteRun(runId) {
    if (!confirm('Are you sure you want to delete this run? This cannot be undone.')) return;
    
    const result = await apiCall(`/api/runs/${runId}`, 'DELETE');
    if (result.success) {
        location.reload();
    } else {
        alert('Failed to delete run');
    }
}
</script>
{% endblock %}
